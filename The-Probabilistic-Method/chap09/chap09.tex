% !TeX encoding = UTF-8
% !TeX program = XeLaTeX
% !TeX spellcheck = LaTeX

\documentclass[a4paper]{article}

\usepackage{amsmath,amsfonts,amssymb}
\usepackage{mathrsfs}
\usepackage{bm}
\usepackage{extarrows}
\usepackage{geometry}
\usepackage{ntheorem}
\usepackage{hyperref}
\usepackage[ruled]{algorithm2e}
\usepackage{caption,subcaption}

\geometry{left=2cm,right=2cm,top=2cm,bottom=2cm}

\def\UrlBreaks{\do\A\do\B\do\C\do\D\do\E\do\F\do\G\do\H\do\I\do\J\do\K\do\L\do\M\do\N\do\O\do\P\do\Q\do\R\do\S\do\T\do\U\do\V\do\W\do\X\do\Y\do\Z\do\[\do\\\do\]\do\^\do\_\do\`\do\a\do\b\do\c\do\d\do\e\do\f\do\g\do\h\do\i\do\j\do\k\do\l\do\m\do\n\do\o\do\p\do\q\do\r\do\s\do\t\do\u\do\v\do\w\do\x\do\y\do\z\do\0\do\1\do\2\do\3\do\4\do\5\do\6\do\7\do\8\do\9\do\.\do\@\do\\\do\/\do\!\do\_\do\|\do\;\do\>\do\]\do\)\do\,\do\?\do\'\do+\do\=\do\#}

\newtheorem{theorem}{Theorem}
\newtheorem{lemma}{Lemma}
\newtheorem{proposition}{Proposition}
\newtheorem{corollary}{Corollary}
\newtheorem{claim}{Claim}
\newtheorem{conjecture}{conjecture}
\newtheorem{definition}{Definition}
\newtheorem{construction}{Construction}
\newtheorem*{proof}{Proof}
\newtheorem*{answer}{Answer}
\newtheorem*{example}{Example}
\newtheorem*{counterexample}{Counterexample}

\newenvironment{exercise}[1]{
	\par
	\noindent\textbf{Exercise #1.}\quad
}{
	\par
	\bigskip
}
\newenvironment{problem}[1]{
	\par
	\noindent\textbf{Problem #1.}\quad
}{
	\par
	\bigskip
}

\DeclareMathAccent{\widehat}{\mathord}{largesymbols}{"62}
\DeclareMathOperator*{\argmax}{\arg\,\max}
\DeclareMathOperator*{\argmin}{\arg\,\min}
\DeclareMathOperator{\E}{\mathbb E}
\DeclareMathOperator{\Var}{\mathrm{Var}}
\DeclareMathOperator{\tr}{\mathrm{tr}}
\DeclareMathOperator{\poly}{\mathrm{poly}}
\newcommand{\abs}[1]{\left| #1 \right|}
\newcommand{\vabs}[1]{\left\| #1 \right\|}
\newcommand{\abra}[1]{\left\langle #1 \right\rangle}
\newcommand{\pbra}[1]{\left( #1 \right)}
\newcommand{\cbra}[1]{\left\{ #1 \right\}}
\newcommand{\sbra}[1]{\left[ #1 \right]}
\newcommand{\floorbra}[1]{\left\lfloor #1 \right\rfloor}
\newcommand{\ceilbra}[1]{\left\lceil #1 \right\rceil}
\newcommand{\bin}{\{0,1\}}
\newcommand{\ZPP}{\mathtt{ZPP}}
\newcommand{\RP}{\mathtt{RP}}
\newcommand{\coRP}{\mathtt{co}\text{-}\mathtt{RP}}
\newcommand{\per}{\text{per}}
\newcommand{\sgn}{\text{sgn}}
\newcommand{\Fbb}{\mathbb{F}}
\newcommand{\Nbb}{\mathbb{N}}
\newcommand{\Rbb}{\mathbb{R}}
\newcommand{\Zbb}{\mathbb{Z}}
\newcommand{\Acal}{\mathcal{A}}
\newcommand{\Bcal}{\mathcal{B}}
\newcommand{\Ccal}{\mathcal{C}}
\newcommand{\Fcal}{\mathcal{F}}
\newcommand{\Gcal}{\mathcal{G}}

\bibliographystyle{plainnat}

\title{Exercise Set --- Chapter $9$}
\date{}

\begin{document}

\maketitle

\begin{exercise}{1}
    \textbf{Remark: This is not the complete solution.}

    Let $\pi_1,\pi_2,\pi_3$ be three independent random permutations in $S_n$.
    Construct a bipartite graph $G=(V_1,V_2,E)$, where $V_1=V_2=[n]$ and 
    $$
    E=\cbra{(i,\pi_1(n)),(i,\pi_2(n)),(i,\pi_3(n))\middle|i\in[n]}.
    $$
    Let $S\subseteq V_1,T\subseteq V_2,|S|+|T|\leq n$ and $0<\delta<1/2$ be a constant to be determined later, then 
    \begin{itemize}
        \item $\max\cbra{|S|,|T|}\geq(\delta+1/2)n$. Then 
            $$
            \frac{|N(S\cup T)|}{|S|+|T|}\geq\frac{N(S)-|T|}{|S|+|T|}\geq\frac{|S|-|T|}{|S|+|T|}\geq2\delta.
            $$
        \item $\max\cbra{|S|,|T|}<\kappa n$. Let $0<\lambda<1/2$ be a constant to be determined later.
            \begin{align*}
                &\Pr\sbra{\exists S,T,\frac{|N(S\cup T)|}{|S|+|T|}<\lambda\middle|\max\cbra{|S|,|T|}<\kappa n}\\
                \leq&2\sum_{|T|\leq|S|<\kappa n}\Pr\sbra{\frac{|N(S\cup T)|}{|S|+|T|}<\lambda}\\
                \leq&2\sum_{|T|\leq|S|<\kappa n}\Pr\sbra{|N(S)|\leq(1+\lambda)|T|+\lambda|S|}\\
                \leq&2\sum_{|S|<\kappa n}\Pr\sbra{|N(S)|\leq(1+2\lambda)|S|}\\
                \leq&2\sum_{i=1}^{\kappa n}\binom ni\binom n{(1+2\lambda)i}\pbra{\frac{(1+2\lambda)i}n}^{3i}.
            \end{align*}
            It can be shown, with $\lambda,\kappa$ sufficiently small, say $\kappa=1/10$, the probability is less than $1$ as $n$ goes to infinity.
        \item $\kappa n\leq\max\cbra{|S|,|T|}<(\delta+1/2)n$. I don't know.
    \end{itemize}
\end{exercise}

\begin{exercise}{2}
    Since $G$ is an $(n,d,\lambda)$-graph, for any $B\subseteq V$ of size $bn$, we have
    $$
    \sum_{v\in V}\abs{|N_B(v)|-bd}^2\leq\lambda^2b(1-b)n.
    $$
    Let $B_c$ be the set of vertices with color $c$,
    then
    \begin{align*}
        \#\cbra{v\middle|N(v)\text{ has $<k$ colors}}
        \leq\sum_{c=1}^k\#\cbra{v\middle|N_{B_c}(v)=\emptyset}
        \leq\sum_{c=1}^k\frac{\lambda^2\frac1k\pbra{1-\frac1k}n}{\frac{d^2}{k^2}}<n.
    \end{align*}
\end{exercise}

\begin{exercise}{3}
    For any fixed $Y,|Y|=5a$.
    Let $X\subseteq V,|X|\leq a$ be any largest subset such that $|N_Y(X)|<2|X|$.
    Then consider any $Z\subset V,Z\cap\pbra{X\cup Y}=\emptyset,|Z|\leq a$.
    \begin{itemize}
        \item $|Z|>|X|$. By the choice of $X$, we have $|N_Y(Z)|\geq2|Z|$.
        \item $|Z|\leq|X|$. Then $X\neq\emptyset$ and $|Z\cup X|>|X|$. 
            \begin{itemize}
                \item $|Z\cup X|\leq a$.
                    Thus by the choice of $X$,
                    $$
                    |N_Y(Z\cup X)|\geq2|Z\cup X|=2|Z|+2|X|.
                    $$
                    Since 
                    $$
                    |N_Y(Z\cup X)|\leq|N_Y(Z)|+|N_Y(X)|<|N_Y(Z)|+2|X|,
                    $$
                    the claim holds as well.
                \item $|Z\cup X|>a$.
                    By assumption, $N_Y(Z\cup X)\neq\emptyset$ and we can repeatedly remove $N_Y(Z\cup X)$ from $Y$
                    until $|Y|\leq a$. Thus
                    $$
                    |N_Y(Z\cup X)|\geq4a.
                    $$
                    On the other hand, $|Z\cup X|\leq 2a$, thus
                    $$
                    |N_Y(Z\cup X)|\leq|N_Y(Z)|+|N_Y(X)|<|N_Y(Z)|+2x\leq|N_Y(Z)|+2(2a-|Z|)
                    $$
                    and then the claim holds as well.
            \end{itemize}
    \end{itemize}
\end{exercise}

\begin{exercise}{4}
    Observe that
    $$
    M=\frac13\sum_{u\in G}|e(N(u))|.
    $$
    Since $G$ is an $(n,n/2,2\sqrt n)$-graph, we have $|N(u)|=n/2$ and
    $$
    \abs{|e(N(u))|-\frac12\times\frac n2\times\pbra{\frac12}^2\times n}\leq\frac12\times2\sqrt n\times\frac n2.
    $$
    Thus 
    $$
    |e(N(u))-\frac{n^2}{16}|=o(n^2)
    $$
    and then
    $$
    \abs{M-\frac{n^3}{48}}=o(n^3),
    $$
    which is equivalent to the original claim.
\end{exercise}

\begin{exercise}{5}
    By Theorem 9.3.2, it suffices to show that with limiting probability $1$, $N_{G_n}(C(4))=(1+o(1))p^4n^4$,
    since it implies $e(A_n,B_n)=p|A_n||B_n|+o(n^2)$ and thus $\abs{d(A_n,B_n)-p}=o(1)$.

    Let $X_{w_1,w_2,w_3,w_4}$ be the indicator variable of ordered cycle $w_1\to w_2\to w_3\to w_4\to w_1$, where
    $w_i$'s are distinct. Then $N_{G_n}(C(4))=\sum_wX_w$.
    On the other hand,
    $$
    \E_w\sbra{N_{G_n}(C(4))}=\sum_w\E\sbra{X_w}=n_{(4)}p^4=n^4p^4+O(n^3)
    $$
    and 
    \begin{align*}
        &\Var_w\sbra{N_{G_n}(C(4))}\\
        =&\E_w\sbra{\pbra{\sum_wX_w}^2}-n^8p^8+O(n^7)\\
        =&n_{(4)}\pbra{(n-4)_{(4)}p^8+4(n-4)_{(3)}p^8+8(n-4)_{(2)}p^7+8(n-4)_{(1)}p^6+8(n-4)_{(0)}p^4}-n^8p^8+O(n^7)\\
        =&O(n^7).
    \end{align*}
    Thus
    $$
    \Pr\sbra{\abs{N_{G_n}(C(4))-\E_w\sbra{N_{G_n}(C(4))}}\geq n^{3.9}}\leq\frac{\Var_w\sbra{N_{G_n}(C(4))}}{n^{7.8}}=o(1),
    $$
    which means $N_{G_n}(C(4))=(1+o(1))p^4n^4$ has limiting probability $1$.
\end{exercise}

\begin{exercise}{6}
    Let $\ell,d,\delta$ be constants to be determined later. 
    By Regularity Lemma, there exists $L=L(\ell,\delta)$ such that for any graph $G=(V,E)$ on $n\geq L$ vertices, $V$ can be 
    partitioned into $V_0,V_1,\cdots,V_k,\ell\leq k\leq L$, where $|V_0|\leq\delta|V|,|V_1|=|V_2|=\cdots=|V_k|$ and 
    all $V_i,V_j,1\leq i<j\leq k$ but at most $\delta k^2$ of them are $\delta$-regular.

    Now we remove the following redundant edges:
    \begin{itemize}
        \item all edges among $V_0,V_i,0\leq i\leq k$, which is at most $\delta n^2$;
        \item all edges among non-$\delta$-regular pairs, which is at most $\delta k^2\times\pbra{\frac nk}^2=\delta n^2$;
        \item all edges in $V_i,i\in[k]$, which is at most $k\times\frac{n^2}{2k^2}=\frac{n^2}{2k}\leq\frac{n^2}{2\ell}$;
        \item all edges among $V_i,V_j,1\leq i<j\leq k$ that $d(V_i,V_j)<d$, which is at most 
            $\binom k2\pbra{\frac nk}^2d\leq\frac{dn^2}2$.
    \end{itemize}
    By assumption, $|E|\geq\pbra{\frac{r-2}{r-1}+\epsilon}\binom n2$, thus there are
    $$
    \pbra{\frac{r-2}{r-1}+\epsilon-4\delta-\frac1\ell-d-o(1)}\binom n2
    :=\pbra{\frac{r-2}{r-1}+\epsilon'-o(1)}\binom n2
    $$
    edges left.

    As long as $\epsilon'>0$, we have a $K_r$ clique in the modified $G$, which means $k\geq r$ and, without loss of generality,
    $d(V_i,V_j)\geq d,1\leq i<j\leq r$ and they are also $\delta$-regular.

    Assume $H$ has $t$ vertices and chromatic number $r$. Then $H$ can be partitioned into $r$ parts by the coloring, which means
    $H$ is contained in a complete $r$-partite graph $T(\underbrace{t,\cdots,t}_r)$. Therefore, we may safely assume $H$ is 
    $T(\underbrace{t,\cdots,t}_r)$; and it suffices to show $V_1,\cdots,V_r$ contains a copy of $H$.

    Let $|V_1|=\cdots=|V_r|=m\geq\frac{(1-\delta)n}\ell$. Now we drop redundant vertices according to the following steps.
    \begin{enumerate}
        \item Initialize $i=1$.
        \item Initialize $k=1$.
        \item Choose $v^i_k\in V_i\backslash\cbra{v_{k'}^i\middle|k'<k}$ 
            satisfying $\abs{N_{V_j}(v^i_k)}>(d-\delta)|V_j|$ for all $j>i$.
        \item Let $V_j\gets N_{V_j}(v^i_k)$ for all $j>i$.
        \item If $k<t$, then let $k\gets k+1$ and go to Step $3$.
        \item If $i<r$, then let $i\gets i+1$ and go to Step $2$.
    \end{enumerate}
    It is easy to see, if Step $3$ above always succeeds, then the graph induced by $v_k^i,i\in[r],k\in[t]$ is isomorphic to $H$.
    Now we prove by induction under the condition $(d-\delta)^{rt}\geq r\delta,\delta m\geq t$, that Step $3$ always succeeds and 
    $|V_j|>(d-\delta)^{k+(i-1)t}m,j>i$ every time after Step $4$ in loop $i$.
    \begin{itemize}
        \item $i=1,k=1.$ (base case) 
            
            Let $S=\cbra{v\in V_1\middle|\abs{N_{V_j}(v)}\leq(d-\delta)|V_j|}$.
            By the $\delta$-regularity of $V_1,V_j,j\geq1$, if $|S|>\delta m$, then 
            $$
            d-\delta<d(S,V_j)\leq\frac{(d-\delta)|V_j|\times|S|}{|V_j|\times|S|}=d-\delta.
            $$
            Thus by union bound, there exists at least 
            $$
            |V_1|-(r-1)\delta m=(1-(r-1)\delta)m>\pbra{(d-\delta)^{rt}-(r-1)\delta}m\geq\delta m\geq t
            $$
            choices of $v_1^1$. Then in Step $4$, $|V_j|=|N_{V_j}(v_1^1)|>(d-\delta)m$ holds for any $j>i$.
        \item $i\geq1,k>1$ or $i>1,k=1.$ (induction on $k$ or $i$) 
            
            Let $S=\cbra{v\in V_i\middle|\abs{N_{V_j}(v)}\leq(d-\delta)|V_j|}$. Since 
            $$
            |V_j|>(d-\delta)^{k-1+(i-1)t}m\geq(d-\delta)^{rt}m\geq r\delta m\geq\delta m,
            $$
            then by the $\delta$-regularity of original $V_i,V_j$, if $|S|>\delta m$, then
            $$
            d-\delta<d(S,V_j)\leq\frac{(d-\delta)|V_j|\times|S|}{|V_j|\times|S|}=d-\delta.
            $$
            Thus by union bound, there exists at least 
            $$
            |V_1|-(r-1)\delta m-(k-1)>\pbra{(d-\delta)^{(i-1)t}-(r-1)\delta}m-t+1\geq\delta m-t+1\geq 1
            $$
            choices of $v_k^i$. Then in Step $4$, $|V_j|=\abs{N_{V_j}(v_k^i)}>(d-\delta)^{k+(i-1)t}m$ holds for any $j>i$.
    \end{itemize}

    Now we optimize the undetermined constants $\ell,d,\delta$ to satisfy the following conditions
    $$
    \begin{cases}
        \epsilon'=\epsilon-4\delta-\frac1\ell-d>0\\
        (d-\delta)^{rt}\geq r\delta\\
        \delta m\geq t
    \end{cases}
    \Leftarrow
    \begin{cases}
        d=\epsilon/2\\
        \ell=4/\epsilon\\
        \delta\text{ sufficiently small}\\
        m \text{, i.e., $n$, sufficiently large}.
    \end{cases}
    $$
\end{exercise}
\noindent\textbf{Remark:} This result is essentially tight considering $H=K_r$ and 
$G$ being a complete $(r-1)$-partite graph $T(\underbrace{n/\pbra{r-1},\cdots,n/\pbra{r-1}}_{r-1})$.

\begin{exercise}{7}
    By the definition of limit sequence, we have
    $$
    \lim_{n\to\infty}t(H,G_n)
    $$
    exists for any finite $H$. Thus
    $$
    \lim_{n\to\infty}t'(H,G_n)
    =\lim_{n\to\infty}\sum_{\substack{H'\subseteq H\\|V(H)|=|V(H')|}}(-1)^{|E(H)|-|E(H')|}t(H',G)
    =\sum_{\substack{H'\subseteq H\\|V(H)|=|V(H')|}}(-1)^{|E(H)|-|E(H')|}\lim_{n\to\infty}t(H',G)
    $$
    exists for any finite $H$.
    On the other hand,
    $$
    \lim_{n\to\infty}t(H,G)
    =\lim_{n\to\infty}\sum_{\substack{H\subseteq H'\\|V(H)|=|V(H')|}}t'(H',G)
    =\sum_{\substack{H\subseteq H'\\|V(H)|=|V(H')|}}\lim_{n\to\infty}t'(H',G),
    $$
    which means they are equivalent.
\end{exercise}

\begin{exercise}{8}
    Here we restate the theorem for convenience.
    \begin{theorem}
        Assume $0<p<1$. Let $G=G_n$ be a sequence of graphs on $n$ vertices with $p\binom n2(1+o(1))$ edges. 
        Assume further that all but $o(n)$ vertices have degree $pn(1+o(1))$. Then the following $6$ properties are 
        equivalent.
        \begin{itemize}
            \item \textbf{Property} $P^p_1$: For every graph $H(s,e)$ on $s$ vertices with $e$ edges
                $$
                N_G^*(H(s,e))=(1+o(1))n^sp^e(1-p)^{\binom s2-e}.
                $$
            \item \textbf{Property} $P^p_2$: For the cycle $C(4)$ with $4$ vertices, $N_G(C(4))\leq(1+o(1))p^4n^4$. 
            \item \textbf{Property} $P^p_3$: $\abs{\lambda_2}=o(n)$.
            \item \textbf{Property} $P^p_4$: For every set $S$ of vertices of $G$, $e(S)=\frac p2|S|^2+o(n^2)$.
            \item \textbf{Property} $P^p_5$: For every two sets of vertices $B,C$, $e(B,C)=p|B||C|+o(n^2)$.
            \item \textbf{Property} $P^p_6$: $\sum_{u,v\in V}\abs{|N(u)\cap N(v)|-p^2n}=o(n^3)$.
        \end{itemize}
    \end{theorem}
    \begin{proof}[$P_1^p\implies P^p_2$]
        Since $N_G(H)=\sum_{H\subseteq L}N_G^*(L)$, where $L$ is a graph on $|V(H)|$ vertices,
        we have
        \begin{align*}
            N_G(C(4))&=N_G^*(H(4,4))+2N_G^*(H(4,5))+N_G^*(H(4,6))\\
            &=(1+o(1))p^4n^4\sbra{(1-p)^2+2p(1-p)+p^2}\\
            &=(1+o(1))p^4n^4.
        \end{align*}
    \end{proof}
    \begin{proof}[$P_2^p\implies P^p_3$]
        Let $A$ be the adjacency matrix of $G$.
        By Perron-Frobenius Theorem, $\lambda_1>0$; thus
        $$
        \lambda_1=\sup_{x\in\Rbb^n}\frac{x^TAx}{x^Tx}\geq\frac{\bm 1^TA\bm 1}{\bm 1^T\bm 1}=pn(1+o(1)).
        $$
        On the other hand,
        $$
        (1+o(1))p^4n^4\geq N_G(C(4))=\tr\pbra{A^4}-o(n^4)=\sum_{i=1}^n\lambda_i^4-o(n^4)\geq p^4n^4(1+o(1))+\lambda_2^4-o(n^4),
        $$
        thus $|\lambda_2|=o(n)$.
    \end{proof}
    \begin{proof}[$P_3^p\implies P_4^p$]
        Let $A$ be the adjacency matrix of $G$.
        Let $\lambda_1,\cdots,\lambda_n$ be the eigenvalues of $G$ and $u_1,\cdots,u_n$ be the corresponding 
        orthonormal eigenvectors.
        \begin{lemma}
            $\vabs{u_1-\frac1{\sqrt n}\vec1}_2=o(1)$.
        \end{lemma}
        \begin{proof}
            Let $v_1=\frac1{\sqrt n}\vec1$ and $v_1=\sum_ia_iu_i$, then $pnv_1+e=Av_1=\sum_ia_i\lambda_iu_i$,
            where $\vabs{e}_2=o(n)$.
            Since by adding dummy edges we can get a $(pn(1+o(1)))$-regular graph, $\lambda_1=\vabs{A}_2\leq pn(1+o(1))$.
            Also, from the proof of $P_2^p\implies P_3^p$, we have $\lambda_1\geq pn(1+o(1))$; thus $\lambda_1=pn(1+o(1))$.
            Thus
            \begin{align*}
                &\sum_ia_i\lambda_iu_i=e+pnv_1=e+pn\pbra{\sum_ia_iu_i}\\
                \implies&\sum_{i>1}a_i\pbra{\lambda_i-pn}u_i=e+pn(pn-\lambda_1)u_1=e+o(n)u_1\\
                \implies&\vabs{\sum_{i>1}a_i\pbra{\lambda_i-pn}u_i}_2=\sqrt{\sum_{i>1}a_i^2(o(n)-pn)^2}=o(n)\\
                \implies&\sum_{i>1}a_i^2=o(1)\implies a_1=1-o(1)\\
                \implies&\vabs{u_1-\frac1{\sqrt n}\vec1}_2=\vabs{u_1-v_1}_2=(a_1-1)^2+\sum_{i>1}a_i^2=o(1).
            \end{align*}
        \end{proof}
        Without loss of generality, assume $|S|=\Theta(n)$, since otherwise $e(S)\leq|S|^2=o(n^2)$.
        Let $\vec1_S$ be the indicator vector of set $S$ and $\vec1_S=\sum_ib_iu_i$.
        Then
        $$
        b_1=\abra{\vec1_S,u_1}=\abra{\vec1_S,\frac1{\sqrt n}\vec1}+\abra{\vec1_S,u_1-\frac1{\sqrt n}\vec1}
        =\frac{|S|}{\sqrt n}+o(\sqrt{|S|})=\frac{|S|}{\sqrt n}+o(\sqrt{n}).
        $$
        Thus 
        $$
        2e(S)=\vec1_S^TA\vec1_S=\sum_i\lambda_ib_i^2=\pbra{\frac{|S|^2}{n}+o(n)}pn(1+o(1))+o(n)\pbra{\sum_{i>1}b_i^2}
        =p|S|^2+o(n^2).
        $$
    \end{proof}
    \begin{proof}[$P_4^p\implies P_5^p$]
        Let $D=B\cap C,B_1=B\backslash D,C_1=C\backslash D$. Then
        \begin{align*}
            e(B,C)&=e(B_1,D)+e(B_1,C_1)+e(D,C_1)+e(D)\\
            &=e(D)+\pbra{e(B_1\cup D)-e(B_1)-e(D)}
            +\pbra{e(B_1\cup C_1)-e(B_1)-e(C_1)}
            +\pbra{e(D\cup C_1)-e(D)-e(C_1)}\\
            &=\frac p2\pbra{\pbra{|B_1|+|D|}^2+\pbra{|B_1|+|C_1|}^2+\pbra{|D|+|C_1|}^2-2|B_1|^2-2|C_1|^2-|D|^2}+o(n^2)\\
            &=p\pbra{|B_1|+|D|}\pbra{|D|+|C_1|}+o(n^2)\\
            &=p|B||C|+o(n^2).
        \end{align*}
    \end{proof}
    \begin{proof}[$P_5^p\implies P_6^p$]
        Define $S=\cbra{u\in V\middle||N(u)|=pn(1+o(1))}$, then $|S|=n-o(n)$ and
        $$
        \sum_{u,v}\abs{|N(u)\cap N(v)|-p^2n}=
        \pbra{\sum_{u\in S}+\sum_{u\notin S}}\sum_v\abs{|N(u)\cap N(v)|-p^2n}
        =\sum_{u\in S}\sum_v\abs{|N(u)\cap N(v)|-p^2n}+o(n^3).
        $$
        Thus it suffices to show for any fixed $u\in S$
        $$
        \sum_v\abs{|N(u)\cap N(v)|-p^2n}=o(n^2).
        $$
        Let $T=\cbra{v\in V\middle||N(u)\cap N(v)|\geq p^2n}$, then
        \begin{align*}
            \sum_v\abs{|N(u)\cap N(v)|-p^2n}
            &=\pbra{\sum_{v\in T}N(u)\cap N(v)}-p^2n|T|
            -\pbra{\sum_{v\notin T}N(u)\cap N(v)}+p^2n(n-|T|)\\
            &=e(N(u),T)-e(N(u),T^c)+p^2n(n-2|T|)\\
            &=p|N(u)|(|T|-n+|T|)+o(n^2)+p^2n(n-2|T|)\\
            &=p^2n(1+o(1))(2|T|-n)+o(n^2)+p^2n(n-2|T|)\\
            &=o(n^2).
        \end{align*}
    \end{proof}
    \begin{proof}[$P_6^p\implies P_1^p$]
        Prove by induction on $s$. 
        
        If $s=1$, then $e=0$ and $N_G^*(H(s,e))=n$. 

        Now we assume $s=k+1,k\geq1$.
        Let $V(H(k+1,e))=v_1,\cdots,v_{k+1}$ and $H'$ be the graph induced by $v_1,\cdots,v_k$.
        Denote $A$ as the adjacency matrix of G and
        $$
        s_b(u,v)=\#\cbra{w\in G\backslash\cbra{u,v}\middle|A_{u,w}=A_{v,w}=b}
        $$
        for $b\in\bin$.
        Let $I_i=1$ if $v_{k+1}$ is linked with $v_i$ and $I_i=0$ otherwise.
        Denote $\Delta=|I|=\sum_iI_i$ and 
        $f$ as 
        $$
        f(w_1,\cdots,w_k)=\#\cbra{x\in G\backslash\cbra{w_1,\cdots,w_k}\middle|A_{x,w_i}=I_i}.
        $$
        Then $N_G^*(H(k+1,e))$ is the summation of $f(w)$ if $G\restriction_w=H'$

        Consider the uniform distribution over $w\in G_{(k)}$. Then
        \begin{align*}
            \mu
            &=\E_w\sbra{f(w)}=\frac1{n_{(k)}}\sum_{w_1,\cdots,w_k}f(w_1,\cdots,w_k)\\
            &=\frac1{n_{(k)}}\sum_{x\in V}\sum_{w_1,\cdots,w_k}[w_1,\cdots,w_k,x\text{ is valid}]\\
            &=\frac1{n_{(k)}}\sum_{x\in V}d(x)_{(\Delta)}\pbra{n-1-d(x)}_{(k-\Delta)}\\
            &=\frac1{n_{(k)}}\pbra{n(pn)_{(\Delta)}(n-1-pn)_{(k-\Delta)}+o(n)n_{(k)}}\\
            &=p^\Delta(1-p)^{k-\Delta}n+o(n)
        \end{align*}
        and 
        \begin{align*}
            \E_w\sbra{f^2(w)}
            &=\frac1{n_{(k)}}\sum_wf^2(w)\\
            &=\frac1{n_{(k)}}\sum_{x,y\in V}\sum_{w_1,\cdots,w_k}[w_1,\cdots,w_k,x\text{ and }w_1,\cdots,w_k,y\text{ are valid}]\\
            &=\frac1{n_{(k)}}\sum_{x,y\in V}s_1(x,y)_{(\Delta)}s_0(x,y)_{(k-\Delta)}\\
            &=\frac1{n_{(k)}}\sum_{x,y\in V}|N(x)\cap N(y)|_{(\Delta)}\pbra{n-2-|N(x)|-|N(y)|+|N(x)\cap N(y)|}_{(k-\Delta)}\\
            &=o(n^2)+\frac1{n_{(k)}}\sum_{x,y\in V}|N(x)\cap N(y)|_{(\Delta)}\pbra{(1-2p)n+|N(x)\cap N(y)|}_{(k-\Delta)}.
        \end{align*}

        Let $\epsilon_{x,y}=|N(x)\cap N(y)|-p^2n$, then $\abs{\epsilon_{x,y}}\leq n$ and by 
        \textbf{Property $P_6^p$}, we have $\sum_{x,y\in V}\abs{\epsilon_{x,y}}=o(n^3)$.
        Thus
        \begin{align*}
            \E_w\sbra{f^2(w)}
            &=o(n^2)+\frac1{n_{(k)}}\sum_{x,y\in V}\pbra{p^2n+\epsilon_{x,y}}_{(\Delta)}
            \pbra{(1-p)^2n+\epsilon_{x,y}}_{(k-\Delta)}\\
            &=o(n^2)+\frac1{n_{(k)}}\sum_{x,y\in V}\sum_{d=0}^k\epsilon_{x,y}^d
            \sum_{i=0}^dc_{x,y,d,i}\pbra{p^2n}^{\Delta-i}\pbra{(1-p)^2n}^{k-\Delta-d+i}\\
            &=o(n^2)+\frac1{n_{(k)}}\sum_{x,y\in V}\pbra{
                \pbra{p^\Delta(1-p)^{k-\Delta}}^2n^k+
                \sum_{d=1}^k\epsilon_{x,y}^d
            \sum_{i=0}^dc_{x,y,d,i}\pbra{p^2n}^{\Delta-i}\pbra{(1-p)^2n}^{k-\Delta-d+i}}\\
            &=o(n^2)+\frac1{n_{(k)}}\pbra{p^\Delta(1-p)^{k-\Delta}}^2n^{k+2}
                +\sum_{d=1}^kO(n^{k-d})\sum_{x,y\in V}\epsilon_{x,y}^d\\
            &\leq o(n^2)+\frac1{n_{(k)}}\pbra{p^\Delta(1-p)^{k-\Delta}}^2n^{k+2}
                +\sum_{d=1}^kO(n^{k-d})O(n^{d-1})\pbra{\sum_{x,y\in V}\abs{\epsilon_{x,y}}}\\
            &\leq o(n^2)+\frac1{n_{(k)}}\pbra{p^\Delta(1-p)^{k-\Delta}}^2n^{k+2}
                +\frac1{n_{(k)}}\sum_{d=1}^kO(n^{k-d})O(n^{d-1})o(n^3)\\
            &=\pbra{p^\Delta(1-p)^{k-\Delta}}^2n^2+o(n^2).
        \end{align*}
        Therefore
        \begin{align*}
            \abs{N_G^*(H(k+1,e))-N_G^*(H')\mu}
            &=\abs{\sum_{w,G\restriction_w=H'}f(w)-\mu}\\
            &\leq\sqrt{N_G^*(H')\sum_{w,G\restriction_w=H'}(f(w)-\mu)^2}\\
            &\leq\sqrt{N_G^*(H')\sum_w(f(w)-\mu)^2}\\
            &\leq\sqrt{N_G^*(H')n_{(k)}\pbra{\E\sbra{f^2(w)}-\mu^2}}\\
            &\leq\sqrt{(1+o(1))n^kp^{e(H')}(1-p)^{\binom k2-e(H')}n_{(k)}o(n^2)}\\
            &=o(n^{k+1}),
        \end{align*}
        which gives
        \begin{align*}
        N_G^*(H(k+1,e))
            &=N_G^*(H')\mu+o(n^{k+1})=n^kp^{e(H')}(1-p)^{\binom k2-e(H')}p^\Delta(1-p)^{k-\Delta}n+o(n^{k+1})\\
            &=(1+o(1))n^{k+1}p^e(1-p)^{\binom{k+1}2-e}
        \end{align*}
        as desired.
    \end{proof}
\end{exercise}

\begin{exercise}{9}
    Let 
    $$
    S=\cbra{k\middle|\exists G_n,\pbra{|E(G_n)|=0.7\binom n2+o(n^2)}\land\pbra{N_{G_n}(C(3))=k\binom n3+o(n^3)}}
    $$
    and
    \begin{align*}
        S'=&\bigg\{k'=\int W(x,y)W(x,z)W(y,z)\bigg|W:[0,1]^2\to[0,1],\\
        &\pbra{W\text{ is Lebesgue measurable}}
        \land\pbra{W(x,y)\equiv W(y,x)}\land\pbra{\int W(x,y)=0.7}\bigg\}.
    \end{align*}
    Let $b=\inf S,b'=\inf S'$ and we need to show $b,b'$ are attained.

    Since $G_n=K_{\sqrt{0.7}n}$ with $k=0.7^{3/2}$ and $W(x,y)\equiv0.7$ with $k'=0.7^3$ are valid candidates, 
    $S,S'$ are not empty.
    On the other hand, $k,k'$ are non-negative, thus $0\leq b\leq0.7^{3/2},0\leq b'\leq0.7^3$.

    \begin{itemize}
        \item $b$ is attained. Let $G_m^k,k\in\Nbb^+$ be a sequence of graph sequence such that for any $k$
            $$
            b\leq\lim_{m\to\infty}\frac{N_{G_m^k}(C(3))}{\binom m3}\leq b+\frac1k.
            $$
            Now construct a new graph sequence $G_n=G_n^n$, then we have
            $$
            b\leq\lim_{n\to\infty}\frac{N_{G_n}(C(3))}{\binom n3}=
            \lim_{n\to\infty}\frac{N_{G_n^n}(C(3))}{\binom n3}\leq b,
            $$
            which means $b$ is attained.
        \item $b'$ is attained. Let 
            $$
            \Ccal=\cbra{W:[0,1]^2\to[0,1]\middle|
            \pbra{W\text{ is Lebesgue measurable}}
            \land\pbra{W(x,y)\equiv W(y,x)}\land\pbra{\int W(x,y)=0.7}}.
            $$
            Define $d(W_1,W_2)=\sup_{x,y\in[0,1]^2}\abs{W_1(x,y)-W_2(x,y)}$, then it suffices to show $\Ccal$ is a complete
            space with metric $d(\cdot,\cdot)$.

            Let $\cbra{W_i}\subseteq\Ccal$ be any Cauchy sequence and $\epsilon_i=d(W_i,W_{i-1})$, 
            then $\lim_{i\to+\infty}\epsilon_i=0$. Define $W^*$ be the limit, i.e.,
            $$
            W^*(x,y)=\lim_{i\to+\infty}W_i(x,y).
            $$
            It is easy to see $W*(x,y)\in[0,1]$ and $W^*(x,y)=W^*(y,x)$. By dominated convergence theorem, $W^*$ is Lebesgue
            measurable and 
            $$
            \int W^*(x,y)=\int\lim_{i\to+\infty}W_i(x,y)=\lim_{i\to+\infty}\int W_i(x,y)=0.7.
            $$
            Thus $W^*\in\Ccal$ and $\Ccal$ is a complete space.
    \end{itemize}
\end{exercise}

\begin{exercise}{10}
    Let $G=G_n=(T_n,B_n,E_n),|T_n|=|B_n|=n$ be a sequence of bipartite graphs. Assume $\lim_{n\to\infty}d(T_n,B_n)=p\in(0,1)$.
    We call such a sequence bipartite quasirandom with parameter $p$ is any one of the following equivalent definitions holds.
    \begin{itemize}
        \item \textbf{Original}: For any $\epsilon>0$, $(T_n,B_n)$ is $\epsilon$-regular for $n$ sufficiently large.
        \item \textbf{Property $B_1^p$}: For every bipartite graph $H(s,t,e)$ on $s\times t$ vertices with $e$ edges
            $$
            N_G^*(H(s,t,e))=(1+o(1))n^{s+t}p^e(1-p)^{st-e},
            $$
            where 
            $$
            N_G^*(H(s,t,e)):=\sum_{\vec u\in\pbra{T_n}_{(s)},\vec v\in\pbra{B_n}_{(t)}}[G\restriction_{\vec u,\vec v}
            \text{ is isomorphic to }H].
            $$
        \item \textbf{Property $B_2^p$}: For the cycle $C(4)$ with $4$ vertices, $N_G(C(4))\leq(1+o(1))p^4n^4$,
            where
            $$
            N_G(H(s,t,e))=\sum_{H\subseteq H'(s,t,e')}N_G(H'(s,t,e')).
            $$
        \item \textbf{Property $B_3^p$}: $\sigma_1=(p+o(1))n,\sigma_2=o(n)$, where $\sigma_i$ is the $i$-th largest singular
            value of the adjacency matrix of $G$.
        \item \textbf{Property $B_4^p$}: For every set $S_1\subseteq T_n,S_2\subseteq B_n$, $e(S_1,S_2)=p|S_1||S_2|+o(n^2)$.
        \item \textbf{Property $B_5^p$}: $\sum_{u,v\in T_n}\abs{\abs{N(u)\cap N(v)}-p^2n}
            +\sum_{u,v\in B_n}\abs{\abs{N(u)\cap N(v)}-p^2n}=o(n^3)$.
    \end{itemize}
    \begin{proof}[Original $\implies$ $B_1^p$]
        For any fixed $H(s,t,e)$, assume $d(T_n,B_n)\in p\pm\frac\epsilon2$.
        Let $A_{T_n\times B_n},A'_{[s]\times[t]}$ be the adjacency matrix of $G$ and $H$ respectively.
        For any pairwise distinct $w_1,\cdots,w_s\in T_n$ and $\alpha\in\bin^s$, denote 
        $$
        f(w_1,\cdots,w_s,\alpha)=\#\cbra{v\in B_n\middle|A_{w_i,v}=\alpha_i,\forall i\in[s]}.
        $$
        Let $\beta_i=(A'_{1,i},A'_{2,i},\cdots,A'_{s,i})$ for all $i\in[t]$ and $c_\beta=\#\cbra{i\in[t]\middle|\beta_i=\beta}$,
        then
        $$
        N_G^*(H(s,t,e))=\sum_{\vec w}\prod_\beta f(\vec w,\beta)_{(c_\beta)}=(1+o(1))\sum_{\vec w}\prod_{i=1}^tf(\vec w,\beta_i).
        $$

        Let 
        $$
        S=\cbra{\vec w\in (T_n)_{(s)}\middle|\exists\alpha\in\bin^s,
        f(\vec w,\alpha)\notin(p\pm2\epsilon)^{|\alpha|}(1-p\pm2\epsilon)^{s-|\alpha|}n}.
        $$
        Then
        \begin{align*}
            N_G^*(H(s,t,e))
            &=(1+o(1))\pbra{\sum_{\vec w\in S}+\sum_{\vec w\notin S}}\prod_{i=1}^tf(\vec w,\beta_i)\\
            &\begin{cases}
                \leq(1+o(1))\pbra{|S|n^t+(n_{(s)}-|S|)(p+2\epsilon)^e(1-p+2\epsilon)^{st-e}n^t}\\
                \geq(1+o(1))\pbra{n_{(s)}-|S|}(p-2\epsilon)^e(1-p-2\epsilon)^{st-e}n^t.
            \end{cases}
        \end{align*}
        Since $\epsilon$ can be arbitrarily small, it suffices to show $|S|=O(\poly(\epsilon)n^s)$.

        Define an indicator function $P:\pbra{T_n}_{(s)}\to[s]\cup\cbra{\bot}$ as follows
        \begin{align*}
        P(\vec w)=i\in[s]\iff
            &\pbra{\abs{\bigcap_{j\leq i}N(w_j)}\notin(p\pm2\epsilon)\abs{T_n\cap\bigcap_{j<i}N(w_j)}}\\
        &\land
            \pbra{\forall k<i,\abs{\bigcap_{j\leq k}N(w_j)}\in(p\pm2\epsilon)\abs{T_n\cap\bigcap_{j<k}N(w_j)}}\\
        \end{align*}
        and $P(\vec w)=\bot$ if no $i\in[s]$ satisfies the condition above.
        Then if $P(\vec w)=\bot$, it is easy to see 
        $f(\vec w,\alpha)\in(p\pm2\epsilon)^{|\alpha|}(1-p\pm2\epsilon)^{s-|\alpha|}n$ holds for any $\alpha\in\bin^s$,
        hence 
        $$
        |S|\leq\#\cbra{\vec w\middle|P(\vec w)\neq\bot}=\sum_{i=1}^s\#\cbra{\vec w\middle|P(\vec w)=i}.
        $$

        Let $\epsilon$ be sufficiently small such that $(p-2\epsilon)^s>\epsilon$.
        For any fixed $i$, assume $P(\vec w)=i$, then let
        $$
        V_{\vec w,i}=T_n\cap\bigcap_{j<i-1}N(w_j),\quad 
        U_{\vec w,i}=\cbra{u\in T_n\middle|\abs{N(u)\cap V_{\vec w,i}}<(p-2\epsilon)|V_{\vec w,i}|},
        $$
        and we have $(p\pm2\epsilon)^{i-1}n\ni|V_{\vec w,i}|>\epsilon n$.
        Assume $|U_{\vec w,i}|\geq\epsilon n$, by the $\epsilon$-regularity of $T_n,B_n$, we have
        $$
        p-\frac\epsilon2-\epsilon\leq d(U_{\vec w,i},V_{\vec w,i})<\frac{(p-2\epsilon)|V_{\vec w,i}||U_{\vec w,i}|}
        {|U_{\vec w,i}||V_{\vec w,i}|}=p-2\epsilon.
        $$
        Similarily, 
        $$
        U_{\vec w,i}':=\cbra{u\in T_n\middle|\abs{N(u)\cap V_{\vec w,i}}>(p+2\epsilon)|V_{\vec w,i}|}
        $$
        has size at most $\epsilon n$.
        Therefore
        $$
        |S|\leq\sum_{i=1}^s\sum_{\text{valid }w_1,\cdots,w_{i-1}}\pbra{\#U_{\vec w,i}+\#V_{\vec w,i}}\leq\epsilon sn^s
        $$
        as desired.
    \end{proof}
    \begin{proof}[$B_1^p\implies B_2^p$]
        Since $N_G(C(4))=N_G^*(C(4))$, the claim holds immediately.
    \end{proof}
    \begin{proof}[$B_2^p\implies B_3^p$]
        Let $A$ be the adjacency matrix of $G$. Then
        $$
        \sigma_1=\sup_{x,y\in\Rbb^n}\frac{x^TAy}{x^Ty}\geq\frac{\bm 1^TA\bm 1}{\bm 1^T\bm 1}=(p+o(1))n.
        $$
        On the other hand,
        \begin{align*}
            (1+o(1))p^4n^4
            &\geq N_G(C(4))\\
            &=\pbra{\sum_{i=1}^ne_i^TA^TAA^TAe_i}-o(n^4)\\
            &=\tr\pbra{A^TAA^TA}-o(n^4)\\
            &\geq\sigma_1^4+\sigma_2^4-o(n^4)\\
            &\geq(p+o(1))^4n^4+\sigma_2^4-o(n^4).
        \end{align*}
        Thus $\sigma_1=(p+o(1))n,\sigma_2=o(n)$.
    \end{proof}
    \begin{proof}[$B_3^p\implies B_4^p$]
        Denote $A$ as the adjacency matrix of $G$.
        Let the SVD of $A$ be $U\Sigma V^T$, where $U=(u_1,\cdots,u_n),V=(v_1,\cdots,v_n)$;
        and $\bm 1_{S_1}=\sum_ia_iu_i,\bm 1_{S_2}=\sum_ib_iv_i$.
        Then
        $$
        e(S_1,S_2)=\bm 1_{S_1}^TA\bm 1_{S_2}=\pbra{\sum_ia_iu_i}A\pbra{\sum_jb_jv_j}=\sum_ia_ib_i\sigma_i.
        $$

        Assume $\frac1{\sqrt n}\bm 1=\sum_ic_iu_i=\sum_id_iv_i,\sum_ic_i^2=\sum_id_i^2=1$, then
        $$
        (p+o(1))n=\frac1n\bm 1^TA\bm 1=\sum_ic_id_i\sigma_i\leq c_1d_1(p+o(1))n+o(n)\sum_{i>1}c_id_i=c_1d_1pn+o(n).
        $$
        Thus $c_1d_1=1-o(1)$. 
        Since $u_1$ is the leading eigenvector of $AA^T\geq\bm0$, by Perron-Frobenius Theorem we have $u_1\geq\bm0$
        and $0\leq\frac1{\sqrt n}\bm1^Tu_1=c_1\leq1$, which means $c_1=1-o(1),d_1=1-o(1)$.
        Therefore
        $$
        a_1=\bm 1_{S_1}^Tu_1=\frac1{\sqrt n}\bm 1_{S_1}^T\bm 1+\bm 1_{S_1}^T\pbra{u_1-\frac1{\sqrt n}\bm 1}
        =\frac{|S_1|}{\sqrt n}+\bm 1_{S_1}^T\pbra{o(1)u_1-\sum_{i>1}c_iu_i}
        =\frac{|S_1|}{\sqrt n}+o(\sqrt n).
        $$
        Similarily, $b_1=\frac{|S_2|}{\sqrt{2n}}+o(\sqrt{|S_2|})$.
        Hence 
        $$
        e(S_1,S_2)=a_1b_1\lambda_1+o(n)\sum_{i>1}a_ib_i=p|S_1||S_2|+o(n^2).
        $$
    \end{proof}
    \begin{proof}[$B_4^p\implies B_5^p$]
        By symmetry, it suffices to show $\sum_{u,v\in T_n}\abs{\abs{N(u)\cap N(v)}-p^2n}=o(n^3)$.
        For any fixed $u$, define $S_u=\cbra{v\in T_n\middle|\abs{N(u)\cap N(v)}\geq p^2n}$. Then
        \begin{align*}
            \sum_{u,v\in T_n}\abs{\abs{N(u)\cap N(v)}-p^2n}
            &=\sum_u\pbra{\sum_{v\in S_u}\pbra{\abs{N(u)\cap N(v)}-p^2n}+\sum_{v\notin S_u}\pbra{p^2n-\abs{N(u)\cap N(v)}}}\\
            &=\sum_u\pbra{e(N(u),S_u)-e(N(u),S_u^c)+p^2n(n-2|S_u|)}\\
            &=\sum_u\pbra{p(pn-|N(u)|)(n-2|S_u|)+o(n^2)}\\
            &=o(n^3)+p\times O(n)\times\sum_u(pn-|N(u)|)\\
            &=o(n^3)+p\times O(n)\times\pbra{pn^2-(p+o(1))n^2}\\
            &=o(n^3).
        \end{align*}
    \end{proof}
    \begin{proof}[$B_4^p\implies$ Original]
        Let 
        $$
        f(n)=\max_{S_1\subseteq T_n,S_2\subseteq B_n}\frac{\abs{e(S_1,S_2)-p|S_1||S_2|}}{n^2},
        $$
        then $f(n)=o(1)$.
        Now for any fixed $\epsilon$, choose $n$ sufficiently large such that $f(n)<\epsilon^3/2$ and 
        $\abs{d(T_n,B_n)-p}<\epsilon/2$.
        Thus for any $S_1\subseteq T_n,S_2\subseteq B_n,|S_1|,|S_2|\geq\epsilon n$, we have
        $$
        d(S_1,S_2)-p=\frac{e(S_1,S_2)}{|S_1||S_2|}-p\in\frac{p|S_1||S_2|\pm f(n)n^2}{|S_1||S_2|}-p\in\pm\frac{f(n)}{\epsilon^2}
        \in\pm\frac\epsilon2
        $$
        and
        $$
        \abs{d(S_1,S_2)-d(T_n,B_n)}\leq\abs{d(S_1,S_2)-p}+\abs{d(T_n,B_n)-p}\leq\epsilon
        $$
        as desired.
    \end{proof}
    \begin{proof}[$B_5^p\implies B_2^p$]
        Let 
        $$
        f(n)=\frac{\sum_{u,v\in T_n}\abs{|N(u)\cap N(v)|-p^2n}}{n^3},
        $$
        then $f(n)=o(1)$.
        For any fixed $\epsilon$, choose $n$ sufficiently large such that $f(n)<\epsilon^2$.

        Observe that
        $$
        N_G(C(4))=\sum_{\substack{u,v\in T_n\\u\neq v}}\abs{N(u)\cap N(v)}_{(2)}=(1+o(1))\sum_{u,v\in T_n}\abs{N(u)\cap N(v)}^2.
        $$
        Let $S=\cbra{(u,v)\in T_n^2\middle|\abs{N(u)\cap N(v)}\in (p^2+\epsilon)n}$, then
        $$
        \epsilon^2n^3>f(n)n^3=\sum_{u,v\in T_n}\abs{|N(u)\cap N(v)|-p^2n}\geq(n^2-|S|)\epsilon n,
        $$
        which means $|S|\geq(1-\epsilon)n^2$.

        Therefore, 
        $$
        N_G(C(4))
            \geq(1+o(1))(1-\epsilon)n^2\times\pbra{(p^2-\epsilon)n}^2
            =(1+o(1))p^4n^4\sbra{(1-\epsilon)\pbra{1-\frac\epsilon{p^2}}^2}
        $$
        and
        $$
        N_G(C(4))
            \leq(1+o(1))\pbra{(1-\epsilon)n^2\times\pbra{(p^2+\epsilon)n}^2+\epsilon n^2\times n^2}
            =(1+o(1))p^4n^4\sbra{(1-\epsilon)\pbra{1+\frac\epsilon{p^2}}^2+\frac\epsilon{p^4}}.
        $$
        Since $\epsilon$ can be arbitrarily small, we have
        $$
        N_G(C(4))=(1+o(1))p^4n^4
        $$
        as desired.
    \end{proof}
\end{exercise}
\noindent\textbf{Remark:} 
\begin{itemize}
    \item $\sigma_1=(p+o(1))n$ is indispensable in \textbf{Property $B_3^p$} considering the case 
    where $T_n,B_n$ is a quasirandom $2pn$-regular bipartite graph over $\frac n2\times\frac n2$ vertices.
    \item I didn't show {\bf$B_5^p\implies$ Original}
        because I don't know how to prove $d(u)\approx pn$ for almost any $u\in T_n\cup B_n$ from $B_5^p$.
        But it seems it's feasible since this can be easily derived from $B_4^p$.
\end{itemize}

%\begin{problem}{11}
%    Assume $H$ is a graph on $s$ vertices with $e$ edges and $G=G(n,W)=(V,E)$.
%    Let $X_w,w\in V_{(s)}$ be the indicator variable about $H\subseteq G\restriction_w$.
%    Then
%    $$
%    t(H,G(n,W))=n^{-s}\sum_{w\in V_{(s)}}X_w=(1-o(1))\frac1{n_{(s)}}\sum_{w\in V_{(s)}}X_w
%    =\frac1{n_{(s)}}\sum_{w\in V_{(s)}}X_w-o(1)
%    $$
%    and
%    $$
%    \Pr\sbra{\abs{t(H,G(n,W))-c(H,W)}>\epsilon}\leq
%    \Pr\sbra{\abs{\frac1{n_{(s)}}\sum_{w\in V_{(s)}}X_w-c(H,W)}>\epsilon-o(1)}.
%    $$
%\end{problem}

\end{document}
